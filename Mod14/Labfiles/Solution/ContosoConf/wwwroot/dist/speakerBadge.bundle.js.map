{"version":3,"file":"speakerBadge.bundle.js","mappings":"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","sources":["webpack://asp.net/./wwwroot/scripts/pages/speaker-badge.js","webpack://asp.net/./wwwroot/scripts/SpeakerBadgePage.js","webpack://asp.net/./wwwroot/scripts/grayscale.js"],"sourcesContent":["import { SpeakerBadgePage } from \"../SpeakerBadgePage.js\";\r\n\r\nconst badgeElement = document.querySelector(\".badge\");\r\nnew SpeakerBadgePage(badgeElement);\r\n\r\n\r\n","import { grayscaleImage } from \"./grayscale.js\";\r\n\r\nexport class SpeakerBadgePage {\r\n\r\n    constructor(element) {\r\n        this.canvas = element.querySelector(\"canvas\");\r\n        this.busyElement = element.querySelector(\".busy\");\r\n\r\n        this.speakerId = this.canvas.getAttribute(\"data-speaker-id\");\r\n        this.speakerName = this.canvas.getAttribute(\"data-speaker-name\");\r\n        this.canvas.addEventListener(\"dragover\", this.handleDragOver.bind(this));\r\n        this.canvas.addEventListener(\"drop\", this.handleDrop.bind(this));\r\n\r\n        this.drawBadge();\r\n    }\r\n\r\n    handleDragOver(event) {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        event.dataTransfer.dropEffect = 'copy'; // Makes the browser display a \"copy\" cursor.\r\n    }\r\n\r\n    handleDrop(event) {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        const files = event.dataTransfer.files;\r\n        if (files.length == 0) return;\r\n\r\n        // More than one file could have been dropped, we'll just use the first.\r\n        const file = files[0];\r\n      if (this.isImageType(file.type)) {\r\n        this.busy();\r\n        // TODO: Add grayscaleImage into the processing pipeline.\r\n        this.readFile(file)\r\n            .then((imageUrl) => this.loadImage(imageUrl))\r\n            .then((image) => grayscaleImage(image))\r\n            .then((processedImage) => {\r\n                this.drawBadge(processedImage);\r\n                this.notBusy();\r\n            })\r\n            .catch((error) => {\r\n                console.error(\"Error processing image:\", error);\r\n                this.notBusy();\r\n            });\r\n        } else {\r\n            alert(\"Please drop an image file.\");\r\n        }\r\n    }\r\n\r\n    drawBadge(image) {\r\n        this.context = this.canvas.getContext(\"2d\");\r\n        this.drawBackground();\r\n        this.drawTopText();\r\n        this.drawSpeakerName();\r\n        if (image) {\r\n            this.drawSpeakerImage(image);\r\n        } else {\r\n            this.drawImagePlaceholder();\r\n        }\r\n        this.drawBarCode(this.speakerId);\r\n    }\r\n\r\n    drawBackground() {\r\n        this.context.fillStyle = \"white\";\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    drawSpeakerImage(image) {\r\n        const size = Math.min(image.width, image.height);\r\n        const sourceX = image.width / 2 - size / 2;\r\n        const sourceY = image.height / 2 - size / 2;\r\n        this.context.drawImage(image, sourceX, sourceY, size, size, 20, 20, 160, 160);\r\n    }\r\n\r\n    drawImagePlaceholder() {\r\n        this.context.strokeStyle = \"2px #888\";\r\n        this.context.strokeRect(20, 20, 160, 160);\r\n        this.context.font = \"12px sans-serif\";\r\n        this.context.textBaseline = \"middle\";\r\n        this.context.textAlign = \"center\";\r\n        this.context.fillStyle = \"black\";\r\n        this.context.fillText(\"Drag your profile photo here\", 100, 100);\r\n    }\r\n\r\n    drawTopText() {\r\n        this.context.font = \"20px sans-serif\";\r\n        this.context.fillStyle = \"black\";\r\n        this.context.textBaseline = \"top\";\r\n        this.context.textAlign = \"left\";\r\n        this.context.fillText(\"ContosoConf 2013 Speaker:\", 200, 20);\r\n    }\r\n\r\n    drawSpeakerName() {\r\n        this.context.font = \"40px sans-serif\";\r\n        this.context.fillStyle = \"black\";\r\n        this.context.textBaseline = \"top\";\r\n        this.context.textAlign = \"left\";\r\n        this.context.fillText(this.speakerName, 200, 60);\r\n    }\r\n\r\n    drawBarCode(text) {\r\n        text = \"*\" + text + \"*\"; // Wrap in \"*\" deliminators.\r\n        const encodings = {\r\n            \"0\": \"bwbWBwBwb\",\r\n            \"1\": \"BwbWbwbwB\",\r\n            \"2\": \"bwBWbwbwB\",\r\n            \"3\": \"BwBWbwbwb\",\r\n            \"4\": \"bwbWBwbwB\",\r\n            \"5\": \"BwbWBwbwb\",\r\n            \"6\": \"bwBWBwbwb\",\r\n            \"7\": \"bwbWbwBwB\",\r\n            \"8\": \"BwbWbwBwb\",\r\n            \"9\": \"bwBWbwBwb\",\r\n            \"*\": \"bWbwBwBwb\"\r\n        };\r\n        let x = 200, y = 140, height = 40, thick = 6, thin = 2;\r\n        for (let charIndex = 0; charIndex < text.length; charIndex++) {\r\n            const code = encodings[text[charIndex]];\r\n            for (let stripeIndex = 0; stripeIndex < code.length; stripeIndex++) {\r\n                if (stripeIndex % 2 === 0) {\r\n                    this.context.fillStyle = \"black\";\r\n                } else {\r\n                    this.context.fillStyle = \"white\";\r\n                }\r\n                const isWideStripe = code.charCodeAt(stripeIndex) < 91;\r\n                if (isWideStripe) {\r\n                    this.context.fillRect(x, y, thick, height);\r\n                    x += thick;\r\n                } else {\r\n                    this.context.fillRect(x, y, thin, height);\r\n                    x += thin;\r\n                }\r\n            }\r\n\r\n            if (charIndex < text.length - 1) {\r\n                // Space between each\r\n                this.context.fillStyle = \"white\";\r\n                this.context.fillRect(x, y, thin, height);\r\n                x += thin;\r\n            }\r\n        }\r\n    }\r\n\r\n    isImageType(type) {\r\n        const imageTypes = [\"image/jpeg\", \"image/jpg\", \"image/png\"];\r\n        return imageTypes.indexOf(type) === 0;\r\n    }\r\n\r\n    readFile(file) {\r\n        // Return a new promise.\r\n        return new Promise(function (resolve, reject) {\r\n\r\n            const reader = new FileReader();\r\n\r\n            reader.onload = function (loadEvent) {\r\n                const fileDataUrl = loadEvent.target.result;\r\n                resolve(fileDataUrl);\r\n            };\r\n\r\n            reader.onerror = function (error) {\r\n              reject(error);\r\n            };\r\n\r\n            reader.readAsDataURL(file);\r\n        });\r\n    }\r\n\r\n    loadImage(imageUrl) {\r\n         // Return a new promise.\r\n         return new Promise(function (resolve, reject) {\r\n            const image = new Image();\r\n\r\n            image.onload = function () {\r\n                resolve(image);\r\n            };\r\n\r\n            image.src = imageUrl; // This starts the image loading\r\n        });\r\n    }\r\n\r\n    busy() {\r\n        this.busyElement.style.display = \"block\";\r\n    }\r\n\r\n    notBusy() {\r\n        this.busyElement.style.display = \"none\";\r\n    }\r\n}\r\n","function createCanvas(size) {\r\n    /// <summary>Creates a canvas used for image manipulation.</summary>\r\n\r\n    const temporaryCanvas = document.createElement(\"canvas\");\r\n    temporaryCanvas.setAttribute(\"width\", size.width);\r\n    temporaryCanvas.setAttribute(\"height\", size.height);\r\n    return temporaryCanvas;\r\n};\r\n\r\nfunction getImageData(context, image) {\r\n    /// <summary>Draws the image onto the canvas context, then returns the resulting image data.</summary>\r\n\r\n    context.drawImage(image, 0, 0);\r\n    return context.getImageData(0, 0, image.width, image.height);\r\n};\r\n\r\nexport function grayscaleImage(image) {\r\n    // Converts a colour image into gray scale.\r\n    return new Promise(function (resolve, reject) {   \r\n        const canvas = createCanvas(image);\r\n        const context = canvas.getContext(\"2d\");\r\n        const imageData = getImageData(context, image);\r\n\r\n        // TODO: Create a Worker that runs /scripts/grayscale-worker.js\r\n        const worker = new Worker(\"/scripts/grayscale-worker.js\");\r\n        \r\n        const handleMessage = function (event) {\r\n            worker.removeEventListener(\"message\", handleMessage);\r\n            worker.terminate(); \r\n            \r\n            if (event.data.error) {\r\n                reject(new Error(event.data.error));\r\n                return;\r\n            }\r\n            \r\n            const processedImageData = new ImageData(\r\n                event.data.data,\r\n                event.data.width,\r\n                event.data.height\r\n            );\r\n            \r\n            context.clearRect(0, 0, canvas.width, canvas.height);\r\n            context.putImageData(processedImageData, 0, 0);\r\n            resolve(canvas);\r\n        };\r\n        \r\n        worker.addEventListener(\"message\", handleMessage);\r\n        worker.addEventListener(\"error\", reject);\r\n        worker.postMessage(imageData);\r\n    });\r\n};\r\n\r\n"],"names":["SpeakerBadgePage","element","_classCallCheck","this","canvas","querySelector","busyElement","speakerId","getAttribute","speakerName","addEventListener","handleDragOver","bind","handleDrop","drawBadge","key","value","event","stopPropagation","preventDefault","dataTransfer","dropEffect","_this","files","length","file","isImageType","type","busy","readFile","then","imageUrl","loadImage","image","Promise","resolve","reject","size","temporaryCanvas","document","createElement","setAttribute","width","height","context","getContext","imageData","drawImage","getImageData","worker","Worker","handleMessage","removeEventListener","terminate","data","error","Error","processedImageData","ImageData","clearRect","putImageData","postMessage","grayscaleImage","processedImage","notBusy","console","alert","drawBackground","drawTopText","drawSpeakerName","drawSpeakerImage","drawImagePlaceholder","drawBarCode","fillStyle","fillRect","Math","min","sourceX","sourceY","strokeStyle","strokeRect","font","textBaseline","textAlign","fillText","text","encodings","x","charIndex","code","stripeIndex","charCodeAt","indexOf","reader","FileReader","onload","loadEvent","fileDataUrl","target","result","onerror","readAsDataURL","Image","src","style","display"],"ignoreList":[],"sourceRoot":""}